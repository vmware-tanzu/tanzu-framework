apiVersion: cni.tanzu.vmware.com/v1alpha1
kind: AntreaConfig
metadata:
  name: cc-cb
  namespace: customcb-ns
spec:
  antrea:
    config:
      disableUdpTunnelOffload: false
      featureGates:
        AntreaPolicy: true
        AntreaProxy: true
        AntreaTraceflow: false
        Egress: true
        EndpointSlice: true
        FlowExporter: false
        NodePortLocal: true
      noSNAT: false
      trafficEncapMode: encap
---
apiVersion: run.tanzu.vmware.com/v1alpha3
kind: ClusterBootstrap
metadata:
  annotations:
    tkg.tanzu.vmware.com/add-missing-fields-from-tkr: v1.23.5---vmware.1-tkg.1-zshippable
  name: cc-cb
  namespace: customcb-ns
spec:
  additionalPackages:
    - refName: metrics-server*
    - refName: secretgen-controller*
    - refName: pinniped*
  cni:
    refName: antrea*
    valuesFrom:
      providerRef:
        apiGroup: cni.tanzu.vmware.com
        kind: AntreaConfig
        name: cc-cb
  kapp:
    refName: kapp-controller*
---
apiVersion: cluster.x-k8s.io/v1beta1
kind: Cluster
metadata:
  annotations:
    run.tanzu.vmware.com/resolve-tkr: ""
  labels:
    tkg.tanzu.vmware.com/cluster-name: aws-cc-wc
  name: aws-cc-wc
  namespace: default
spec:
  clusterNetwork:
    pods:
      cidrBlocks:
        - 100.96.0.0/11
    services:
      cidrBlocks:
        - 100.64.0.0/13
  topology:
    class: tkg-aws-default
    controlPlane:
      metadata:
        annotations:
          run.tanzu.vmware.com/resolve-os-image: ami-region=us-west-2,os-name=ubuntu
      replicas: 1
    variables:
      - name: cni
        value: antrea
      - name: region
        value: us-west-2
      - name: sshKeyName
        value: aws-utkg
      - name: loadBalancerSchemeInternal
        value: false
      - name: bastion
        value:
          enabled: false
      - name: network
        value:
          subnets:
            - az: us-west-2a
              private:
                id: subnet-0b0f28c172c229261
              public:
                id: subnet-017721635d6fd36bc
          vpc:
            existingID: vpc-03eabce14a3931ec2
      - name: identityRef
        value: {}
      - name: worker
        value:
          instanceType: t2.xlarge
          rootVolume:
            sizeGiB: 80
      - name: controlPlane
        value:
          instanceType: t2.xlarge
          rootVolume:
            sizeGiB: 80
    version: v1.23.8+vmware.2
    workers:
      machineDeployments:
        - class: tkg-worker
          failureDomain: us-west-2a
          metadata:
            annotations:
              run.tanzu.vmware.com/resolve-os-image: ami-region=us-west-2,os-name=ubuntu,os-arch=amd64
          name: md-0
          replicas: 1
